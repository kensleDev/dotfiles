import { test, expect } from "bun:test";
import { challengesByTool, getUnlockedTools, allChallenges } from "./challenges";

test("challenge registry should have all tools", () => {
  expect(Object.keys(challengesByTool)).toEqual(['fd', 'sed', 'awk', 'jq', 'rsync']);
});

test("should have 13 total challenges", () => {
  expect(allChallenges.length).toBe(13);
});

test("each tool should have 5 challenges", () => {
  Object.entries(challengesByTool).forEach(([tool, challenges]) => {
    console.log(`${tool}: ${challenges.length} challenges`);
  });
});

test("unlocked tools should start with only fd", () => {
  const initialState = {
    toolProgress: { fd: 0, sed: 0, awk: 0, jq: 0, rsync: 0 },
    completedChallenges: []
  };

  const unlocked = getUnlockedTools(initialState.toolProgress);
  expect(unlocked).toEqual(['fd']);
});

test("all challenges should have required properties", () => {
  allChallenges.forEach(challenge => {
    expect(challenge).toHaveProperty('id');
    expect(challenge).toHaveProperty('title');
    expect(challenge).toHaveProperty('story');
    expect(challenge).toHaveProperty('tool');
    expect(challenge).toHaveProperty('difficulty');
    expect(challenge).toHaveProperty('estimatedTime');
    expect(challenge).toHaveProperty('hints');
    expect(challenge).toHaveProperty('solution');
    expect(challenge).toHaveProperty('setup');
    expect(challenge).toHaveProperty('validation');
  });
});

test("challenge difficulties should be 1-5", () => {
  allChallenges.forEach(challenge => {
    expect(challenge.difficulty).toBeGreaterThanOrEqual(1);
    expect(challenge.difficulty).toBeLessThanOrEqual(5);
  });
});