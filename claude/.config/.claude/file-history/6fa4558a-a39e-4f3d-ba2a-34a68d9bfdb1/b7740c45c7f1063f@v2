import { Challenge } from '../..';
import * as fs from 'fs';
import * as path from 'path';

export const challenges: Challenge[] = [
  {
    id: 'awk-1',
    title: "Log Detective",
    tool: 'awk',
    story: `ðŸ” Performance Investigation

The app is slow! You need to analyze the access logs.

Your task: Calculate the average response time from .cli-quest-game/access.log
The response time is the last column (in milliseconds).
Save just the number to .cli-quest-game/avg-response.txt (rounded to integer)`,

    setup: () => {
      // This will be handled by the game runner
    },

    validation: () => {
      const resultFile = path.join(process.cwd(), '.cli-quest-game/avg-response.txt');
      if (!fs.existsSync(resultFile)) return false;

      const content = fs.readFileSync(resultFile, 'utf-8').trim();
      // Average is (145+230+180+95+310+120+150+200+175+195)/10 = 180
      return content === '180';
    },

    hints: [
      "awk processes columns. $NF is the last column (response time)",
      "Sum values: awk '{sum+=$NF} END{print sum}' file",
      "Try: awk '{sum+=$NF} END{printf \"%.0f\", sum/NR}' .cli-quest-game/access.log > .cli-quest-game/avg-response.txt"
    ],

    solution: "awk '{sum+=$NF} END{printf \"%.0f\", sum/NR}' .cli-quest-game/access.log > .cli-quest-game/avg-response.txt",
    difficulty: 1,
    estimatedTime: 5
  }
];

// Placeholder functions for other awk challenges
export const challenge2: Challenge = {
  id: 'awk-2',
  title: "Status Code Analysis",
  tool: 'awk',
  story: "Placeholder for awk challenge 2",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 2,
  estimatedTime: 5
};

export const challenge3: Challenge = {
  id: 'awk-3',
  title: "User Activity",
  tool: 'awk',
  story: "Placeholder for awk challenge 3",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 3,
  estimatedTime: 5
};

export const challenge4: Challenge = {
  id: 'awk-4',
  title: "Traffic Analysis",
  tool: 'awk',
  story: "Placeholder for awk challenge 4",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 4,
  estimatedTime: 5
};

export const challenge5: Challenge = {
  id: 'awk-5',
  title: "Advanced Processing",
  tool: 'awk',
  story: "Placeholder for awk challenge 5",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 5,
  estimatedTime: 5
};