import { Challenge } from '../..';
import * as fs from 'fs';
import * as path from 'path';

export const challenges: Challenge[] = [
  {
    id: 'rsync-1',
    title: "Deployment Day",
    tool: 'rsync',
    story: `ðŸš€ Time to Deploy!

You need to deploy your Next.js app to the staging server.
But first, let's do a DRY RUN to see what would be copied.

Source: .cli-quest-game/app
Destination: .cli-quest-game/staging

Rules:
- Sync everything from /app to /staging
- Exclude node_modules
- Exclude .env files
- Use archive mode
- Do a DRY RUN first (very important!)

Your task: Run rsync with dry-run flag and save its output to .cli-quest-game/deploy-preview.txt`,

    setup: () => {
      // This will be handled by the game runner
    },

    validation: () => {
      const resultFile = path.join(process.cwd(), '.cli-quest-game/deploy-preview.txt');
      if (!fs.existsSync(resultFile)) return false;

      const content = fs.readFileSync(resultFile, 'utf-8');

      // Should include package.json, page.tsx, layout.tsx, logo.png
      // Should NOT include node_modules or .env files
      return content.includes('package.json') &&
             content.includes('page.tsx') &&
             content.includes('layout.tsx') &&
             !content.includes('node_modules') &&
             !content.includes('.env');
    },

    hints: [
      "rsync with dry-run: rsync -avn source/ dest/",
      "Exclude patterns: rsync -av --exclude='pattern' source/ dest/",
      "Try: rsync -avn --exclude='node_modules' --exclude='.env*' .cli-quest-game/app/ .cli-quest-game/staging/ > .cli-quest-game/deploy-preview.txt"
    ],

    solution: "rsync -avn --exclude='node_modules' --exclude='.env*' .cli-quest-game/app/ .cli-quest-game/staging/ > .cli-quest-game/deploy-preview.txt",
    difficulty: 1,
    estimatedTime: 5
  }
];

// Placeholder functions for other rsync challenges
export const challenge2: Challenge = {
  id: 'rsync-2',
  title: "Advanced Excludes",
  tool: 'rsync',
  story: "Placeholder for rsync challenge 2",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 2,
  estimatedTime: 5
};

export const challenge3: Challenge = {
  id: 'rsync-3',
  title: "Remote Sync",
  tool: 'rsync',
  story: "Placeholder for rsync challenge 3",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 3,
  estimatedTime: 5
};

export const challenge4: Challenge = {
  id: 'rsync-4',
  title: "Backup Strategy",
  tool: 'rsync',
  story: "Placeholder for rsync challenge 4",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 4,
  estimatedTime: 5
};

export const challenge5: Challenge = {
  id: 'rsync-5',
  title: "Complex Deployment",
  tool: 'rsync',
  story: "Placeholder for rsync challenge 5",
  setup: () => {},
  validation: () => false,
  hints: [],
  solution: "echo 'placeholder'",
  difficulty: 5,
  estimatedTime: 5
};