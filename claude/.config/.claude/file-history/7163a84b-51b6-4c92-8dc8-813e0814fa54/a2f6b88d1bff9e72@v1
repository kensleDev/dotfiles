<script lang="ts">
  import { getAuthState } from "@/auth/guards.svelte";
  import Button from "@/components/ui/button/button.svelte";
  import MenuSheet from "@/shell/MenuSheet.svelte";
  import { cn } from "@/utils";
  import { ArrowUp, LogOut, QrCode } from "@lucide/svelte";

  let { signOut, cameraSheetOpen = $bindable() } = $props();

  const authStatus = await getAuthState();
  console.log({ authStatus });

  let showBackground = $state(false);

  let scanQrCode = () => {
    cameraSheetOpen = true;
  };

  $effect(() => {
    const handleScroll = () => {
      const scrollY = window.scrollY;
      const newIsPastLogo = scrollY > 10;

      if (newIsPastLogo !== showBackground) {
        showBackground = newIsPastLogo;
      }
    };

    window.addEventListener("scroll", handleScroll);

    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  });
</script>

<nav
  class={cn(
    "w-full py-4 fixed top-0 left-0 right-0 animate-in fade-in" +
      (showBackground ? " !bg-black transition-all" : "")
  )}
>
  <div
    class="inner max-w-[1100px] w-full mx-auto flex items-center justify-between px-x-section"
  >
    <img src="/logo-full.svg" alt="Logo" class="w-35 md:w-50" />

    <MenuSheet {signOut} />

    <div class="hidden md:flex items-center gap-4">
      {#if authStatus === "subscribed"}
        <Button
          href="/auth/sign-out"
          variant="outline"
          onclick={() => signOut()}
          class="!border-white hover:text-red-400 hover:!border-red-400 border"
        >
          <LogOut />
          Sign Out
        </Button>
      {:else if authStatus === "anon"}
        <Button
          href="/subscribe"
          variant="outline"
          onclick={() => signOut()}
          class="!border-white hover:text-red-400 hover:!border-red-400 border"
        >
          <ArrowUp />
          Upgrade
        </Button>
      {/if}

      <Button
        variant="outline"
        class="group !border-green-400 text-green-400 hover:text-white hover:!border-white"
        onclick={() => scanQrCode()}
      >
        <QrCode
          class="w-4 h-4 text-green-400 group-hover:text-white transition-colors duration-200"
        />
        Scan QR
      </Button>

      <!-- <ThemeSwitch /> -->
    </div>
  </div>
</nav>
