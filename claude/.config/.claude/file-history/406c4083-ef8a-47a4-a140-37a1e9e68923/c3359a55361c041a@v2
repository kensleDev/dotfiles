<script lang="ts">
  import PageContainer from "@/shell/PageContainer.svelte";
  import type { ScanDisplay } from "@/types";
  import QrScanHistory from "./QrScanHistory/QrScanHistory.svelte";
  import QrScanner from "./QrScanner/QrScanner.svelte";

  let { cameraSheetOpen } = $props<{
    cameraSheetOpen: { value: boolean };
  }>();

  let isDetailsOpen = $state(false);
  let selectedScan = $state<ScanDisplay | null>(null);

  // Listen for startScan event from QrScanHistoryEmptyState
  $effect(() => {
    const handleStartScan = () => {
      cameraSheetOpen.value = true;
    };

    window.addEventListener("startScan", handleStartScan);

    return () => {
      window.removeEventListener("startScan", handleStartScan);
    };
  });
</script>

<PageContainer title="Scan History" isScanning={cameraSheetOpen.value}>
  <QrScanner bind:cameraSheetOpen={cameraSheetOpen.value} bind:isDetailsOpen />

  {#if !cameraSheetOpen.value}
    <QrScanHistory bind:isDetailsOpen bind:selectedScan />
  {/if}
</PageContainer>
