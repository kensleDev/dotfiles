<script lang="ts">
  import { Scan } from "@lucide/svelte";

  let {
    cameraSheetOpen = $bindable(),
    isDetailsOpen = $bindable(),
  } = $props();

  function handleScan() {
    cameraSheetOpen = true;
  }
</script>

<!-- Scan Button -->
{#if !isDetailsOpen && !cameraSheetOpen}
  <button
    onclick={handleScan}
    class="mobile-scan-button rounded-full size-20 z-30 flex items-center justify-center fixed bottom-5 right-5 from-green-500 to-green-700 bg-gradient-to-br hover:scale-105 active:scale-95 transition-transform shadow-lg shadow-green-500/30 hover:shadow-green-500/50 text-white opacity-80 md:hidden"
    style="position: fixed; bottom: calc(env(safe-area-inset-bottom, 0px) + 1.25rem); right: calc(env(safe-area-inset-right, 0px) + 1.25rem);"
  >
    <Scan class="size-10" />
  </button>
{/if}

<style>
  /* Fix for iOS Safari viewport issues with fixed positioning */
  .mobile-scan-button {
    position: fixed !important;
    z-index: 9999;
    /* Use -webkit-sticky for better iOS compatibility */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    /* Ensure button stays in viewport during scroll */
    will-change: transform;
  }

  /* Additional mobile Safari fixes */
  @supports (-webkit-touch-callout: none) {
    .mobile-scan-button {
      /* Fix for iOS Safari address bar changes */
      bottom: max(env(safe-area-inset-bottom), 1.25rem);
      right: max(env(safe-area-inset-right), 1.25rem);
      /* Prevent button from being affected by viewport changes */
      transform: translateZ(0);
    }
  }
</style>
