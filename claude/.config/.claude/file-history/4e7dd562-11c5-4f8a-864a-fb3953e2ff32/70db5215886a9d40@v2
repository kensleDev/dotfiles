<script lang="ts">
	import { goto } from '$app/navigation';
	import { resolve } from '$app/paths';
	import { dialogsStore } from '@/state/dialogs.store.svelte';
	import { pagesStore } from '@/state/pages.store.svelte';
	import LinkDialog from '../editor/dialogs/LinkDialog.svelte';
	import NewPageDialog from '../editor/dialogs/NewPageDialog.svelte';
	import type { ImportResult } from '../editor/import/markdownImport.service';
	import MarkdownImportDialog from '../editor/import/MarkdownImportDialog.svelte';

	let { workspaceId, orgId, userId, onSubmit } = $props();

	// Markdown import handler
	function handleImportComplete(result: ImportResult) {
		console.log('Import completed:', result);
		void pagesStore.refetchPagesWithoutContent();
	}

	// Link dialog handler
	function handleLinkSubmit(data: {
		url: string;
		text: string;
		type: 'internal' | 'external';
		pageId?: string;
	}) {
		// Use the registered editor callback if available
		if (dialogsStore.editorLinkCallback) {
			dialogsStore.editorLinkCallback(data);
		} else {
			// If no editor callback, just navigate to internal links
			if (data.type === 'internal' && data.pageId) {
				goto(resolve(`/e?pg=${data.pageId}`));
			}
		}
	}
</script>

<MarkdownImportDialog {workspaceId} {orgId} {userId} onComplete={handleImportComplete} />
<NewPageDialog {onSubmit} />
<LinkDialog onSubmit={handleLinkSubmit} />
